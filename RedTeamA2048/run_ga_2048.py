from socketIO_client import SocketIO, LoggingNamespace
import sys
import time
import numpy
from g2048 import logic

from pybrain.tools.shortcuts import buildNetwork

genome = [-5.433030625763447,
3.4951135788288994, 6.626124536128895, 8.598657645802088, -6.868296964621534, 2.6262572650022626, -8.497419354946478,
1.0563471506838429, -1.487523531891954, 7.710156024570523, -1.2583561837680826, 6.251216787618166, -3.4288383099553617,
9.839099245426716, -2.5367346339821832, 3.7263665085543742, -9.004844970117546, -8.107382768884342, 6.348258284297486,
-7.00186930080627, -3.383518622550616, -2.0264556396497335, -4.103820002338905, 1.5803153808954118, -2.2846724050903227,
9.832050420871386, -8.441660809886946, -9.491453868293519, 6.1885913874193434, 0.49746859272337396, -2.4159566000103805,
-2.0103178230450203, -9.908728033458459, 6.405609824759374, 1.722816378262909, 7.078781524259771, 9.32466637535596,
7.040363363000765, -6.0379220156223585, 4.65269840891075, 9.088093810344773, -3.4456277353616542, 5.899461027516326,
-6.950430929572679, 6.079157588070359, -8.218379494471346, -9.857492738114752, 8.435241068887912, -2.8155569259964164, -9.801234885795838, 7.028131109820098, -4.177656917717498, -0.8594573181687597, -0.5576676130162355, 4.811435203234408, 5.8271447271495465, 6.665776343676537, -5.5953233034610905, 2.4303391227857105, 2.314558236627324, 0.91426143326869, -2.210449496913771, -4.925589489565905, -3.954662408731588, -3.165519216969437, -4.357649422746861, 3.8575945841541817, -9, 9.465299131979794, -4.396775482767891, 6.666509137766784, -8.319507696398423, 2.980623391241828, 1.270123518439405, 1.357572106829421, 7.684024125179366, 0, 6.290081753364582, 4.306098125492312, -9.289115099764606, -4.26631141792309, 7.427173694964104, -5.687943119197638, -2.022050293662687, -3.460595381134521, 5.9074798871311955, 9.28980932876922, -9.161822267041082, -9.6467899792055, -1.5308383705542887, -2.7106394346122737, -3.1931524512975322, -4.510527890341298, -0.10567594093826926, -8.129339033972336, -3.874861729525703, -4.386180754882543, -6.206575215522292, 4.368934573314595, 7.5117514922579005, -7.602754718262242, -0.8861519312617077, 1.4977933502207073, -3.7956861600174063, -2.2391851379652117, 3.100719976820283, -9.323455432136056, -6.886907649851796, 5.21106181650527, -5.179549329786727, 7.655253962280597, 8.79220353128829, -4.027864664948433, 2.153357314382365, -7.35619591348912, -1.58301447381589, 3.5008626221990866, 3.697060285989078, -8.229024477633782, 9.658110132981381, 4.5799694091786325, -5.2163988101840575, 9.826759641133737, 2.8676991643015963, 0.864630780936853, -4.943104715049655, 5.517316610432017, 7.417239461427318, 5.329545136311417, -8.421795716760288, -2.3564893540513303, 6.475898779746231, -4.682376451876409, 5.702539002531708, 5.272166014530573, -1.730006045924581, 7.905742530331878, -1.562287048767475, 9.98465372739733, 7.309973772323872, -3.835494853266641, 9.392904514168073, 4.0993668614074235, 7.3656436683496835, 7.269136726692359, -9.387478757824365, 6.511818177037139, -2.9399098098047283, 1.3161399942854786, -4.933150007022881, 9.369148892384523, -4.497176012838057, -7.8285790095978385, 0.46021582148922846, -3.2545809139108943, 7.922715327931378, -5.492670784781528, 4.031794876758262, 7.279783447130011, 3.790627218049419, 4.055528490286228, 6.067220502160794, -9.364217578730118, 3.1131088210031717, 8.493426078005381, -2.476396616897185, 6.984070776677523, 0.6815755968749357, 2.1414660927579483, 4.583912286451158, -2.188305288447536, 2.1784443846616934, -5.3862127879170485, -4.772140098641877, 5.6113094915322925, -2.112642731105727, -3.134642432402403, -7.053088589234213, -0.9849326649475003, -8.220964682127573, -9.67086827422573, 1.9344663385241727, -0.904436204444071, 9.559538178858208, 3.6348379817563536, 1.5121496275114197, -5.262275173659152, 0.8730906665393476, 8.33588608047695, -4.774865117007236, 4.5526917709709345, 5.233518437648099, -0.09366493590496638, 2.9755631549728196, -4.187248839801619, -9.821698668898904, -6.657914822389426, -2.8769132039615304, -0.5583486564722744, 3.8800436795975184, 0.7353355910093029, -0.6995232073233737, 5.247538423285189, 9.453871849635242, -5.545810217767433, 4.203103182309242, -2.0753250279399182, 7.433554045144486, 1.8658918504947426, 2.8074337729892633, 4.106934242069421, 9.018697279401021, 3.814852464566801, -4.835540695789568, -6.929406020524702, -7.563796097571287, -5.959372845836239, 7, 4.110862369340966, -2.1686049592656946, -0.5720242313603041, -6.2748237902892035, -6.136482118002156, 5.268064448963873, 0.8452177506830889, 2.876933886612756, 1, 0.9357162312974214, -5.900409673725386, -2.7099722489948075, -6.477976263751937, -1.7655113750180256, 5.652708891919492, 5.993154726012925, 9.649387676371177, 4.7221941780066405, -1.0884352952606484, 8, -3.779692980540963, -6.559444806403796, -7.77321728096763, 4, -2.4644580589223324, -2.4844140031353135, 7.133264659546803, -6.067648079884296, -4.653313468443969, 3.0699827213556077, 0.6389121157645672, -7.724492055081784, 4.794946732212136, -0.546946205153322, -0.1146711408892962, -4.313454211743368, 7.926324396834477, 4.487140100579925, -7.876512224846348, -8.633111670721087, 5.770504022538594, -1.2954396535647703, 7.762256898839475, 4.748808436068776, -5.643337858354345, -2.251600353156256, 8.187622224839725, 4.344650062456285, 5.082141845615437, -1.9813148320775085, 3.7612610326662406, -7.64153540713536, -0.804772795901421, 5.067180989439194, -2.6814460579854105, 7.488791311315875, -2.9777777972105373, 3.7692975327654565, 8.41328006456989, -1.4533740425817232, -5.502886306737493, 2.4760919395535943, 2.9794244005872113, 6.74466789070771, -9.28774831184715, 1.8055527408767595, 2.6460449129648147, 8.41366671455394, -8.8148466804822, 8.442062409048383, 5.839530704928597, 2.271193832456877, -6.286699378416034, -8.042090959059019, -1.0521103702395056, -8.34545842704018, 6.004457813671479, -9.502649379761536, 5.216854214743872, 3.6028597015661585, -8.96862189828102, 3.403272372580574, 4.7303856839960154, -1.491277462677294, 0.9614234095459668, -1.5516721479242523, 2.700736438121453, -1.4489884652933682, 2.352805918159822, -0.4856189859374851, -1.2091055356301776, -6.313776757321721, -3.513375623456863, 7.198064048920649, -6.6648494189630325, 0.7931118482239938, 2.9959857603643076, 9.906669760558714, -9.645769757952714, 4.121694521997929, 6.4054490665505845, 7.154106240327046, -1.6267347078593737, 0.696834377132129, -7.128622115709097, -8.781847831847504, -8.000463247448184, -6.8555389242396725, 5.116255691018344, 7.193397596703935, 6.553444394453223, 6.420432600472761, -0.5589314379215278, -2.3404995243900606, 5.865404207620697, -9.861034362296433, -5, -9.611248338680678, -1.908060679183393, -8.776765992018223, 6.525146225357723, 6.375880587549762, -0.054271837062298545, -1.583012671733492, 1.3728100361689037, -9.390543560695129, 0.4075120349722603, 3.027877576428576, -4.973591508895748, -0.6163438672993475, -5.183403387070358, -0.3240830090774729, -5.296816980354302, 4.214282916089619, -2.6482686995056888, -7.694108234239792, -5.683325472612289, -8.041815551204031, 0.31752215749144774, 5.444927768571851, 3.7598031611743465, -4.241599758994576, -7.391278786095046, -7.460920443001086, -1, -4.243289511043171, 2.53677911986043, -4.765388807311015, 8.98307934019239, 6.221832161537588, 3.085167027281692, 0.94621589418092, 2.3351243256711935, -0.548811115046755, -2.742309388605033, 2.4169677563580283, -1.9430347275874702, -9.93802244337112, -8.364908729729803, -0.00025652170433687616, 4.084707550043042, 3.056642736079384, 5.60709559469673, -6.821685049654118, -2.3961937845657033, -6.289930713097336, -8.67086116446302, 0.7784199789245996, 7.461888551649352, -5.238003628450436, 8.787986666441249, 7.335223105645355, 8.003201460675633, -2, -2.2664278629182526, -0.8256743403924212, 3.203938924263749, -6.586472640995201, 4.500522431191323, -1.9855368381053946, 6.8107005302896155, -4.163899434613194, -9.663320120035316, -1.283543596517024, 8.344852426890135, -6.171582897125347, -6.346388937991961, 8.735358313384104, -9.226510678730014, -5.93536811420829, -2.8832938176701877, 4.955801748328401, 8.719637076479327, -6.282186385777, -6.89216481115825, 0.24427847794648727, -1.298781052561118, -8.774353596569389, -0.578359155393187, -4.533431098759064, 6.834679033162139, 0, -1.5589737661581147, -5.2465241857371065, -8.198158114617392, -1.4130598996647734, -7.259988513379434, 2.7175834279547466, -8.746241455546384, -7.784346454082208, 9.97571557994975, -0.8402941937489476, 2.7049958149204514, -8.10609732300043, 1.6701759269601961, -1.4939513651635217, -3.7390498052736687, 6.625889120019732, 0.8236460759387256, 3.350232096781232, -3.6026374886103607, 5.758569564029916, -1.1145367314969352, -7.787983671290714, -7.464011803306989, 9.742376081892218, 7.158186108973194, -6, -6.870609135208651, 1.8308611403571824, 9.943616840754984, 3.1387832636216686, -6.31432097522008, -7.343446891153372, 4, 6.5189517730095545, 6.8427878008338325, 9.46403603534447, 9.667486379832702, -5.888969591402741, -5.454828939071867, -3.3236125437588644, 4.442926313679337, 4.894424799793164, -6.285757263346923, -2.723369522824952, -0.7625772365611194, -6.957176397564659, -3.7159960294867194, 4.8626951451242295, -8, 2.3886849129912306, 5, -3, 4.021376508219568, -0.6215495755238081, 4.847941909817148, 4.922983901013362, -5.983918698890216, 7.41283575707962, 5.180820555529536, -8.91653986688053, -7, 5.321522932382663, 7.05328744974306, -7.544871583845341, 8.985807846366857, 9.500720098724532, 7.372035014087075, -7.273358216832748, 4.6219452567696155, 3.518632453538931, -2.194470867887417, -3.6675468693616464, -3.595347162482949, -6.830310853852433, 7.728922722271889, 9.21260383976772, 9.363681662216948, -3.244518530537537, -4, 6.2594794281103034, -3.2626060598775126, -3.5198014299174263, -3.373480197958399, -3.814624869506879, -3.12715060056078, -9.703278971146528, -2.249392773172425, -4.217978783674252, -3.337567848406488, 6.529576608528313, -7.014693961175674, 1.7126837822508545, 4.185211456452604, 2.619094175772233, -8.130649877698879, 4.880743038400112, 7.008126356022174, -3.0773116086594126, 7.952353555790637, -0.29035582371026436, -0.6051511738733133, 6.883778884465535, 5.608363726926662, 5.390503321819715, 4.27823038226656, 6.379755226154867, 8.580098733850498, 2.206843583052443, -5.5165288880012175, 7.007246157431037, 4.343357855507204, -7.705583183362372, 0.15684874235803647, 0.8593909744821246, 2.7574645015791415, 6.062226480093884, 8.113162071305247, 7.404447094961718, 9.480956219611091, -1.9990699649030041, 6.204194348575712, -8.14832101734087, -3.6763817830053487, -2.821518189479395, 1.264043120183695, 0.5795736986633315, -2.1732532703489387, 7.349384052553752, 2.924957242760877, -5.618868063739841, -8.600027372528185, -2.012420849704717, 5.873452059975531, 7.327321857360079, -9.37625547102802, -2.300922796597269, -7.645099879269939, 8.301848702268316, -9.214332913119454, 4.984930980528052, 5.075695883619185, 8.586299634662783, -2.509147717752482, 6.13657973850448, -5, 7.458066417027535, -2.0022163921624188, -7.901148597925345, -0.44689756866368846, 2.1779306866347365, -7.478124523473131, -3.2297207297312696, 1.174975301823629, 2.2416461878491383, 1.4475533355078714, 2.526836091030205, -3.642299832390245, -5.132462665223006, 7.333898541976808, 7.904055407899055, -4.566347371571384, -3.844149433424353, -9.615635352566938, 5.979128389986023, 0.441917148873598, 3.4518872915048266, 4.721396493602679, -7.935893715712485, -9.089549892007383, -1, -5.322093486555566, 2.4466334828500447, 7.266498890549354, -9.98609967181904, 6.386505128681627, -6.474516772093029, 3.891083797309033, 4.310099224064825, -5.4630143748687825, -2.0799053700941617, 9.091290823539829, 5, 4.377468753621805, -7.958686220828057, -9.22749452654453, 6, 10, 7.387171380166041, 7.33880516685646, 0.07592113657700494, 0.9213842937383188, -0.33376640381581346, -8.092825633224566, -5.545741477367406, -8.65747505062952, 3.4705382912603255, 5.598037821125869, -8, -3.4976452139891423, 9.979068347046606, -0.026097200748759875, 0.07609237997129803, 9, 5.289690815242656, 8.126498071172392, -9.815052227238969, 2.0992523599235984, -3.5369981787653026, -8.54049566279542, -0.3114442185577371, 4.760796199345052, -6.845115130648807, -2.3330745897127585, 4.477653810027737, 8.072635299184608, -1.2985010095213863, -6.608349019742805, 4.704015467483902, 1.451413016578698, -7.788104574902508, -9.016695006017537, -3.3052614884758764, 0.3740096557378223, -0.9743422809894682, -9.496737468521644, -9.589759125066335, 9.757590803818818, -6.812486421023887, 3.24464417348066, 8.007651689730846, -0.9566749378142809, 2.1220820656645483, -7.802102292383832, 9.088476311577793, -1.2314865451167272, 3.7061237032130467, 0.12189067218869809, -7.195082360892025, 3.4376581849737615, 5.946087633234178, -6.228945248864333, 1.164282955945728, 3.2534012072420957, 3.9575947457209146, -6.549808031367004, -6.079650841385236, -4.8368398787816, -4.381018834515514, 6.0346694148558875, 1.2742928223554237, -0.16203381226475955, 7.562492368252535, 2.0536258233609637, -0.8677357247004736, -3.6465303738824906, 2.8831393479778313, -8.380943683891006, -1.2916552325182646, 3.1255183082337723, 6.7372243101706815, 1.2890234629062256, -9.149429911772568, -3.6624006635571815, -4.02465060978495, -2.2909504214080805, -0.25784461524214564, 0.5449854301632371, 5.137487951451638, -5.5046335183018495, 7.278281731559751, -4.395251490404335, 9.24363701651243, -4.672465673027297, 5.695822659817189, -6.508131892403304, -3.064971849233351, 8.741067880522703, 3.280737125240874, 4.787891284859105, 2.080626894622693, 10, -2.187411702992783, -1.7488984751517211, 2.662242956469477, 2.9933125681100226, 3, 4.97082806182477, 4.067776412806472, 5.54956722291146, -9.25035745591353, 2.821822645118612, -8.442525985987396, 9.985211305028706, 9.342720702858173, -9.38304872632489, -4.49831728084413, 5.653401882018192, -4, 3.927678939326322, -5.918508426924223, 5.829852670613118, -6.62914650273102, -8.81208325347982, 0.2875465984041199, 7.673244472078451, -9.892300341193966, 6.852366583958439, 6.257035711313566, -9.618032471945817, 8.404457301305403, -6.099670453674316, 4.60152850378503, 4.8919264989491555, 0.5825249950534506, 3.7470141959715892, -3.7734885730001855, -6.981126418935526, -5.3987076362055, 6.080443041569371, -0.9003899454681026, 9.96482624856582, 2.321467118735246, 5.393769340139771, 4.086019186708876, 0.5098389582321232, -4.75651346071754, -0.9520446216434983, 8.326936259298591, 5.644873990408861, 1.749509978372533, -8.954669867566555, 10, -8.335156501993715, 8.579115966635445, 7.8223202068556965, 1.3834124467198308, 2.1539298833653504, 6.312691200181678, -1.4889963108951587, 2.945488224404084, -0.5846456116466534, -1.0157239057237817, -9.519554484418798, -3.422547587524905, -8.813163186721479, -8.703842517948061, 9.584221059021477, 2.976980320830693, 7.521702913277618, -8.593318124794916, 0.5671686990086577, 7.401304398952991, -6.322506628772393, 0.9099801957682736, 7.990950190819909, 3.191575956417566, -2.4644604488026367, 1, 7.246243561371234, -3.9939046387486226, -3.090501478846628, -8.779238813525108, -5.659871122674403, -4.494585952736894, -7.9050186477685, -4.368409641955264, -4.811226313818682, 1.3268042026191367, 2.944702299373441, 8.11924734013289, -8.515153528126964, -9.688293187914962, 0.5462439191023414, 7.112547556184921, 9.98309428421215, -5.137408249497466, 0.29264194906732044, -5.94589966372501, -2.6164237262816243, -4.364275029528633, 8.39981451334847, -4.215029069213799, 7.188090981040286, -1.495443934482994, 4.783610476521341, 5.304234540405211, -8.601708748465327, -9.191343891872787, 1.1530845341204845, 7.890450257192349, -2.825025198813604, -8.528423529285194, -9.620595147000095, -2.3431558783573774, -8.218666451090842, 1.562249811403289, 9.992553566298287, 4.960179752501205, -3.2517164456352576, 6.1861515577577855, -8.080574134380683, -2.205245148809687, -7, 2.4672040134838333, -9.459657547978725, -3.648067332638907, 2.2189484464764675, 0.5214908973243908, 7.404037251937318, 9.314668813657548, -0.7516483334553818, -6.118234479678806, 1, -7.545779182852408, -3.4529458787800227, 2.110559178117061, -9.6013771828529, -6.919431652022341, 9.38642679867393, -3.3014380018739553, -8.723381468251398, -2.512471670949992, 1.4167253725209878, -7.387570356932747, 3.8093601545038442, 0.5321816603608873, 6.361139595910188, 5.062961463057077, -9.222251566850863, 9.231599294255503, 2.3494097416984427, -8.184966189834302, 2.8174538464243, 7.291626469831911, -5.7478917324837635, 8.029038185553791, -7.6275684814748, 6.840404033304701, 4.043298200672002, 6.187730408191033, 0.3488338590533395, -1.1949792801416077, 9.061806306968776, 9, 8.365225706184184, 8.630535558082737, -9.725683127632461, -8.263543604430403, 6.547376543609893, 4.332490461224181, -0.792391015687457, 1.6704799060845037, -2.7601307459336795, -0.7783193183242414, 3.978723631901813, 0.7085070945225276, 7.269556767378962, -2.943250855097279, -6.598493787943108, -4.181843196247971, -7.00075991263345, 2.3962695831855, 4.009140928634098, -9.55004055881328, -1.4530409696662971, -8.326995675904907, -1.6057712168900409, 2.3025529383223606, -8.039818813020878, -5.262562572594625, -9, -1.8486319120110206, -5.169346562394268, -5.351920394692915, 7.533704673595555, 4.232738033202859, 8.368851097143406, 9.177050460367212, -1.733593787862178, -6, 0.8729023775177698, -9.947787764153063, -8.113719862123308, 3.1163372146277286, -4.3625944916484505, 7.1875052531271315, -4.1560979990165325, -7.8282312601264685, -2.365664485351296, 8.364794972993717, -7.288980278423292, -1.9050550212976098, -9.378410185987494, 3.4759964136855785, -8.087165156244813, -6.18197854437589, 9.92959804989787, 7.638451844575425, 0.6892054296094585, 2.055372152670177, -2.3598393411280245, -5.044577869326985, -5.416731652912072, 7.571054269241692, -7.240049665104856, 5.426430116333638, -7.562373539728822, -2.3599468762359095, 9.40539240911686, 3.0834059205514883, -8.539068529456948, -6.5504873833583765, -9.027547662714198, -5.992679624320953, -0.7339179737196453, 3.3864578135526546, 2.543216448739937, -4.9166715541074275, 2.853580518547151, 3.9089186958358013, 2.6240667629876953, -0.22202651969807796, -8.229588317865472, 5.004825520726012, 1.2601191009367945, 0.4062596640136267, -6.8764369477586, -2.5626041402772914, 1, 7.702843776544444, 3.449875897274799, -3.838690210216324, -5.528467477475923, 3.62989825840039, 4.320768076582782, -7.635842264752927, 2.8712913111205207, 8.74436281409984, 5.99363849342679, -9.136085644491757, 2.8712745812242595, -4.6247297105529395, -5.352352510845795, 8.550320145397926, 1.085656482539541, 7.294776630794541, -7.659152739471276, 5.050513530990841, 4.742264515224408, -4.790323623550583, -2.111178623022396, 4.533488446597179, 1.7445014422359773, -7.6387722052164015, 8.49827863505142, 9.045822963030584, 9.94827696773789, -0.6856540394760167, 5.007273088042446, -8.95530025504382, 1.6622706399441096, -8.968493248649311, 7.0044282167966045, 7.044092774095208, 2.218400369121756, 8.18887820628187, 4.295193852736697, 0.9351343240912673, 6, -5.218146812462634, 7.899505253075617, -3.989800533945176, -1.151739788954508, -9.569342228662086, -5.254955958459386, -3.5337467702030168, -9.884968738154406, 3.979153264748385, 0.6417107799828514, -1.0186151938066939, 2.859060752409304, 9.78664218982718, -4.857762782665662, -0.4131510895188981, -9, -6.326978701042187, -6.330107637107057, -0.34140524823289553, 6.606036994463999, 9.127092177093608, -6.662580196909975, -6.133158213386782, 5.911963337138356, 7.305691746781704, -4.423389477167394, 8.877276073690066, -9.494023925623736, -9.1202533459583, -5.438221017225889, 5.721424913266544, 8.247099708253767, 7.022504100462815, 7.252644165099461, 9.49380524006041, 8.974407186384603, 9.930319429972297, -4.397417387875457, -4.710175495266739, -1.5980266829524652, -4.853998335526997, 5.522264098609966, 4.798893684948691, -9.320055249291892, -5.338480157121963, 5, -0.01061654422221281, -8.673224232167263, 9.192362561707547, 0.3772078482350203, -8.651281295043464, -3.5724472491308816, -8.495005197229107, 2.627708598869967, 1.9308154412792096, -5.085042956457122, 1.8555863192133426, 6.039109395285344, -8.521065050352206, 7.335501769282715, -6.790590446395905, -7.835731378193957, -8.897674178549192, 1.1749522922787232, 9.761339275118615]

DIR_UP = (0, -1)
DIR_DOWN = (0, 1)
DIR_RIGHT = (1, 0)
DIR_LEFT = (-1, 0)

myId = "admin"

kmap = {"UP": 38, "DOWN": 40, "LEFT": 37, "RIGHT": 39}
lkmap = {"UP": DIR_UP, "DOWN": DIR_DOWN, "LEFT": DIR_RIGHT, "RIGHT": DIR_LEFT}

STEPS = ["UP", "DOWN", "RIGHT", "LEFT"]

new_params = numpy.array(genome)
net = buildNetwork(16, 50, 4)
net._setParameters(new_params)

def algorithm(data):
    data = data.split(" ")
    data.pop(0)
    int_data = map(int, data)
    result = net.activate(int_data)
    ma = max(result)
    direction = [i for i, j in enumerate(result) if j == ma]

    socketIO.emit("aiwrite", kmap[STEPS[direction[0]]])


def error(msg):
    print(msg)
    socketIO.disconnect()
    pass

socketIO = SocketIO('localhost', 5000, LoggingNamespace)

socketIO.on("airead", algorithm)
socketIO.on("error", error)
socketIO.on("disconnected", error)
socketIO.emit("login", myId, "admin")
socketIO.emit("connect")
socketIO.emit("aictl", myId)
socketIO.wait()
